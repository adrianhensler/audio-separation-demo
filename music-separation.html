<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Separation Demo - 1812 Overture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 8px;
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .pipeline-step {
            margin-bottom: 8px;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .step-number {
            background: #8B5CF6;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 1.4em;
            color: #333;
            font-weight: 600;
        }

        .step-description {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .audio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .audio-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: box-shadow 0.2s;
        }

        .audio-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .audio-card h3 {
            color: #333;
            margin-bottom: 4px;
            font-size: 1em;
        }

        .audio-desc {
            color: #888;
            font-size: 0.82em;
            margin-bottom: 12px;
        }

        .audio-card audio {
            width: 100%;
        }

        .mix-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }

        .mix-card h3 {
            color: #333;
            margin-bottom: 4px;
        }

        .mix-card .audio-desc {
            color: #888;
            font-size: 0.82em;
            margin-bottom: 12px;
        }

        .mix-card audio {
            width: 100%;
            max-width: 600px;
        }

        .flow-arrow {
            text-align: center;
            padding: 14px 0;
            font-size: 2em;
            color: #8B5CF6;
            line-height: 1;
        }

        .callout {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 10px;
            padding: 16px 20px;
            margin-top: 20px;
            font-size: 0.93em;
            color: #92400E;
            line-height: 1.5;
        }

        .callout strong {
            color: #92400E;
        }

        .audio-error {
            color: #dc3545;
            font-size: 0.85em;
            display: none;
            margin-top: 8px;
        }

        .audio-card.error .audio-error,
        .mix-card.error .audio-error {
            display: block;
        }

        .audio-card.error audio,
        .mix-card.error audio {
            opacity: 0.3;
        }

        .tech-info {
            margin-top: 30px;
            padding: 20px;
            background: #F5F3FF;
            border-radius: 10px;
            font-size: 0.9em;
            color: #555;
            line-height: 1.6;
        }

        .tech-info h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .tech-info code {
            background: #E9D5FF;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .nav-links {
            text-align: center;
            margin-top: 30px;
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #8B5CF6;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 20px;
            border: 2px solid #8B5CF6;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-links a:hover {
            background: #8B5CF6;
            color: white;
        }

        @media (max-width: 600px) {
            body { padding: 20px 10px; }
            .container { padding: 20px; }
            h1 { font-size: 1.6em; }
            .audio-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéº Music Separation Demo</h1>
        <p class="subtitle">1812 Overture with Cannons + Opera Singer</p>

        <!-- Step 1: Original tracks -->
        <div class="pipeline-step">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">Original Music Tracks</div>
            </div>
            <p class="step-description">
                Four AI-generated musical elements using <strong>Stable Audio Open 1.0</strong>:
                orchestral music inspired by the 1812 Overture (with cannons!), opera vocals,
                percussion, and bass strings.
            </p>
            <div class="audio-grid">
                <div class="audio-card">
                    <h3>üé∫ Orchestra + Cannons</h3>
                    <p class="audio-desc">1812 Overture style &middot; Brass & Strings</p>
                    <audio controls preload="metadata" src="music/originals/orchestra-cannons.wav"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>üé§ Female Vocals</h3>
                    <p class="audio-desc">Opera Soprano &middot; Classical Voice</p>
                    <audio controls preload="metadata" src="music/originals/female-vocals.wav"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>ü•Å Percussion</h3>
                    <p class="audio-desc">Timpani & Orchestral Drums</p>
                    <audio controls preload="metadata" src="music/originals/percussion.wav"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>üéª Bass Strings</h3>
                    <p class="audio-desc">Cello & Double Bass</p>
                    <audio controls preload="metadata" src="music/originals/bass-strings.wav"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
            </div>
        </div>

        <div class="flow-arrow">&darr;</div>

        <!-- Step 2: Mixed -->
        <div class="pipeline-step">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">Mixed Music</div>
            </div>
            <p class="step-description">
                All four tracks combined into one epic musical piece using
                <strong>ffmpeg</strong>'s amix filter, normalized to 44100&nbsp;Hz mono.
            </p>
            <div class="mix-card">
                <h3>üéµ Full Mix</h3>
                <p class="audio-desc">Orchestra + Vocals + Percussion + Bass</p>
                <audio controls preload="metadata" src="music/mixed.wav"></audio>
                <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
            </div>
        </div>

        <div class="flow-arrow">&darr;</div>

        <!-- Step 3: Separated -->
        <div class="pipeline-step">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">Demucs Separation</div>
            </div>
            <p class="step-description">
                The mixed music separated by <strong>Demucs (htdemucs)</strong>
                into four stems. Since Demucs is trained on music, it should cleanly
                isolate the vocals, percussion, bass, and other orchestral elements!
            </p>
            <div class="audio-grid">
                <div class="audio-card">
                    <h3>Vocals</h3>
                    <p class="audio-desc">Opera singer isolated</p>
                    <audio controls preload="metadata" src="music/separated/vocals.mp3"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>Bass</h3>
                    <p class="audio-desc">Low strings extracted</p>
                    <audio controls preload="metadata" src="music/separated/bass.mp3"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>Drums</h3>
                    <p class="audio-desc">Percussion & timpani</p>
                    <audio controls preload="metadata" src="music/separated/drums.mp3"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
                <div class="audio-card">
                    <h3>Other</h3>
                    <p class="audio-desc">Brass, strings, cannons</p>
                    <audio controls preload="metadata" src="music/separated/other.mp3"></audio>
                    <p class="audio-error">Not found &mdash; run ./generate-music.sh</p>
                </div>
            </div>

            <div class="callout">
                <strong>Perfect Match!</strong> Unlike the speech/environmental sound experiment,
                this demo uses actual musical elements that Demucs was trained to separate.
                The vocals should end up in "vocals", percussion in "drums", low strings in "bass",
                and the orchestral parts (including cannons!) in "other".
            </div>
        </div>

        <div class="tech-info">
            <h3>How It Works</h3>
            <strong>Generate:</strong> <code>stackadoc/stable-audio-open-1.0</code> for all musical elements
            &nbsp;&bull;&nbsp;
            <strong>Mix:</strong> <code>ffmpeg -filter_complex amix</code>
            &nbsp;&bull;&nbsp;
            <strong>Separate:</strong> <code>cjwbw/demucs</code> (htdemucs model)
            &nbsp;&bull;&nbsp;
            All models run on <a href="https://replicate.com" target="_blank" style="color:#8B5CF6">Replicate</a>
        </div>

        <div class="nav-links">
            <a href="index.html">‚Üê Speech/Sound Experiment</a>
            <a href="https://github.com/adrianhensler/audio-separation-demo">View on GitHub</a>
        </div>
    </div>

    <script>
        document.querySelectorAll('audio').forEach(function(audio) {
            audio.addEventListener('error', function() {
                var card = audio.closest('.audio-card, .mix-card');
                if (card) card.classList.add('error');
            });
        });
    </script>
</body>
</html>
